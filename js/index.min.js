!function(){function i(a,b){var c=b?1e3:1024;if(Math.abs(a)<c)return a+" B";var d=b?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],e=-1;do a/=c,++e;while(Math.abs(a)>=c&&e<d.length-1);return a.toFixed(1)+" "+d[e]}function j(a){for(var b=a.split(","),d=(b[0].match(/:(.*?);/)[1],atob(b[1])),e=d.length,f=new Uint8Array(e);e--;)f[e]=d.charCodeAt(e);return f}function l(){var a=$(".range-slider"),b=a.getElementsByTagName("input"),c=parseFloat(b[0].value),d=parseFloat(b[1].value);if(c>d){var e=d;d=c,c=e}var f=$(".range-values");return f.innerHTML=c+" - "+d,c+"-"+d}function m(){var a=$("#speed-control");return $(".speed-value").innerHTML=a.value,a.value}function n(b){a.postMessage({type:"command",arguments:b,file:{name:"input.png",data:g}})}function o(a,b){if(b.match(/\.jpeg|\.gif|\.jpg|\.png/)){var c=new Blob([a]),d=window.URL.createObjectURL(c);return d}}function p(){a=new Worker("js/worker.js"),a.onmessage=function(a){var b=a.data;if("ready"==b.type)$(".loading").style.display="none",$(".loaded").style.display="block",$("#compress").disabled=!1,$("#reset").disabled=!1;else if("stdout"==b.type)c.textContent+=b.data+"\n";else if("start"==b.type)c.textContent="Worker has received command\n";else if("done"==b.type){var d=b.data;d&&d.length&&(c.className="closed"),d&&d.forEach(function(a){$("#output-img").src=o(a.data,"output.png"),$("#output-file-stats").innerHTML="Output image ["+i(a.data.byteLength)+"]",$(".output-preview").style.display="block",$(".compress-text").style.display="none",$(".refresh-container").style.display="block"})}}}var a,c,c=null;window.$=document.querySelector.bind(document);var g=null,k=function(a){var b=new FileReader;b.onload=function(b){$("#input-img").setAttribute("src",b.target.result),$("#input-file-stats").innerHTML="Input image ["+i(a.size)+"]",$("#terminal").style.display="block",$("#file-dropper").style.display="none",g=j(b.target.result)},b.readAsDataURL(a)};document.addEventListener("DOMContentLoaded",function(){c=$("#output"),p(),$("#filePicker").onchange=function(a){a.preventDefault();var b=$("#filePicker");if(b.files&&b.files[0]){if(!b.files[0].name.match(/.(png)$/i))return void alert("not a valid PNG image");k(b.files[0])}},$("#file-dropper").ondragover=function(){return this.className="hover",!1},$("#file-dropper").ondragend=function(){return this.className="",!1},$("#file-dropper").ondrop=function(a){this.className="",a.preventDefault();var b=a.dataTransfer.files[0];k(b)};var a=$(".range-slider");Array.isArray(a)||(a=[a]);for(var b=0;b<a.length;b++)for(var d=a[b].getElementsByTagName("input"),e=0;e<d.length;e++)"range"===d[e].type&&(d[e].oninput=l,d[e].oninput());$("#speed-control").oninput=m,$("#speed-control").oninput(),$("#compress").onclick=function(a){a.preventDefault(),$("#console").style.display="block",$(".compress-text").style.display="block",$("#control-panel").style.display="none",n({quality:l(),speed:""+m()})},$("#reset").onclick=function(a){a.preventDefault(),$("#input-img").setAttribute("src",""),$("#input-file-stats").innerHTML="",$("#terminal").style.display="none",$("#file-dropper").style.display="block",g=null},$("#refresh").onclick=function(a){a.preventDefault(),$("#output-img").src="",$("#output-file-stats").innerHTML="",$(".output-preview").style.display="none",$("#output").innerHTML="",$("#console").style.display="none",$("#input-img").setAttribute("src",""),$("#input-file-stats").innerHTML="",$("#terminal").style.display="none",$("#file-dropper").style.display="block",$(".refresh-container").style.display="none",$("#control-panel").style.display="block",g=null}})}();
